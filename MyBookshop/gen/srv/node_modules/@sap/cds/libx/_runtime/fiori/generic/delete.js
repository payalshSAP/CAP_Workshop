const cds = require('../../cds')
const { deleteDraft } = require('../utils/delete')

/**
 * Generic Handler for DELETE requests.
 * In case of success it returns an empty object.
 * If the entry to be deleted does not exist, it rejects with error to return a 404.
 *
 * @param req
 */
const fioriGenericDelete = function (req, next) {
  if (!req.target._isDraftEnabled) return next()

  // we should call deleteDraft only for draft tables and call next
  // to pass delete of active tables to our general implementation
  return deleteDraft(req, this, true)
}

module.exports = cds.service.impl(function (srv) {
  srv.on('DELETE', '*', fioriGenericDelete)
})
