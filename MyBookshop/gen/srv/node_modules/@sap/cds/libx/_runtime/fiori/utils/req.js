const _ref2name = ref => (ref.id || ref).replace(/_drafts$/, '')

const isNavigationToMany = (req, model) => {
  // only one segment -> false
  if (req.subject.ref.length < 2) return

  // last segment has it's own where -> false
  if (req.subject.ref[req.subject.ref.length - 1].where) return

  // determine the csn element of the last navigation and return it's is2many property
  let cur
  for (let i = 0; i < req.subject.ref.length - 1; i++) {
    cur = cur
      ? model.definitions[cur.elements[_ref2name(req.subject.ref[i])].target]
      : model.definitions[_ref2name(req.subject.ref[i])]
  }
  const last = cur.elements[_ref2name(req.subject.ref[req.subject.ref.length - 1])]
  return last.is2many
}

module.exports = {
  isNavigationToMany
}
